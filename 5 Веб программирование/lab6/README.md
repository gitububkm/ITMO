# News Frontend (React + Vite)

Фронтенд для лабораторных работ 2–5 (новости, авторы, комментарии и авторизация). Реализован на Vite + React + TypeScript.

## Возможности

- Просмотр списка новостей и страницы конкретной новости
- Авторизация/регистрация, хранение access/refresh токенов, запрос `/auth/me`
- Создание, редактирование и удаление новостей в зависимости от роли (админ или верифицированный автор)
- Просмотр, создание, редактирование и удаление комментариев в зависимости от прав
- Авто‑подстановка `Authorization` и обновление access‑токена по refresh‑токену

## Требования

- Node.js 18+ (проверено на 18.20)
- npm 9+ (или совместимый менеджер пакетов)
- Запущенный backend API из лабораторных работ 2–5

## Настройка окружения

Создайте файл `.env` (рядом с `package.json`) и задайте URL backend’а:

```
VITE_API_URL=http://localhost:8000
VITE_DEV_PORT=5173
```

`VITE_DEV_PORT` опционален, но позволяет быстро сменить порт разработки.

## Локальный запуск

```bash
npm install
npm run dev   # старт dev-сервера Vite
npm run build # production-сборка
npm run preview # предпросмотр production-сборки
```

По умолчанию приложение доступно на `http://localhost:5173`.

## Страницы и сценарии

- `/` — список новостей. Верифицированные авторы и админы видят кнопку «Создать новость».
- `/news/:id` — детальная страница новости с содержимым и комментариями. Разрешённые действия:
  - авторизованные пользователи оставляют комментарии;
  - автор комментария или админ может его редактировать/удалять;
  - автор новости (если он верифицирован) и админ могут редактировать/удалять публикацию.
- `/auth` — страница входа/регистрации, отображение текущей сессии и списка активных refresh‑токенов, кнопка «Выйти из всех сессий».

## Используемые эндпоинты API

| Назначение | Метод/URL |
|------------|-----------|
| Получение списка новостей | `GET /news` |
| Получение одной новости | `GET /news/{id}` |
| Создание новости (автор/админ) | `POST /news` |
| Обновление новости (автор новости или админ) | `PUT /news/{id}` |
| Удаление новости (автор новости или админ) | `DELETE /news/{id}` |
| Комментарии новости | `GET /comments/news/{newsId}` |
| Создание комментария | `POST /comments` |
| Обновление комментария (автор или админ) | `PUT /comments/{id}` |
| Удаление комментария (автор или админ) | `DELETE /comments/{id}` |
| Регистрация | `POST /auth/register` |
| Авторизация | `POST /auth/login` |
| Текущий пользователь | `GET /auth/me` |
| Обновление access по refresh | `POST /auth/refresh` |
| Выход из текущей сессии | `POST /auth/logout` |
| Список активных сессий | `GET /auth/sessions` |
| Выход из всех сессий | `DELETE /auth/sessions` |

> Все запросы выполняются через `axios`. Токены хранятся в `localStorage`, refresh‑токен используется для фонового продления access‑токена.

## Создание нового репозитория

1. Создайте приватный репозиторий в организации `https://github.com/orgs/itmo-webdev`.
2. Скопируйте содержимое проекта туда и запушьте.
3. Убедитесь, что в README остаётся инструкция по запуску (этот файл) и что приложение собирается командами выше.

## Полезные команды

- `npm run lint` — проверка ESLint
- `npm run dev -- --host 0.0.0.0 --port 5174` — пример запуска на другом хосте/порте

После запуска:
1. Зарегистрируйте/авторизуйте пользователей через `/auth`.
2. Проверьте роль и флаг `is_verified_author` через backend (ЛР 3).
3. Создайте новость, откройте её страницу, добавьте комментарий.
4. Попробуйте отредактировать/удалить новость и комментарии в соответствии с правами — интерфейс автоматически скрывает недоступные действия.
