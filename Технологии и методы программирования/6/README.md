# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ6 ‚Äî ¬´–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏¬ª

–ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí MFA ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** –Ω–∞ —á–∏—Å—Ç–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞).  
–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `localStorage` –¥–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π.

---

## üöÄ –î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü—ã

| –°—Ç—Ä–∞–Ω–∏—Ü–∞        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                         |
|-----------------|--------------------------------------------------------------------|
| `index.html`    | –ì–ª–∞–≤–Ω–∞—è. –ö–Ω–æ–ø–∫–∞ **¬´–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª** –≤–µ–¥—ë—Ç –∫ –õ–†-6.                 |
| `register.html` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (PBKDF2-SHA-256 + —Å–æ–ª—å).                               |
| `login.html`    | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π MFA ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.       |
| `mfa.html`      | –í–≤–æ–¥ 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (–≤ –¥–µ–º–æ –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ).        |
| `app.html`      | –ü–∞–Ω–µ–ª—å: —Ä–æ–ª–∏, refresh, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è, MFA, —Ä–æ–ª–∏, —Å–µ—Å—Å–∏–∏.            |

> üéì –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–µ–º–æ-–∞–¥–º–∏–Ω: **login:** `admin`, **password:** `admin123`.

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–¥–∞–Ω–∏—é

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
- **–ë–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ø—Ä–æ—Å—Ç–∞—è –ë–î –Ω–∞ `localStorage` (`users[]`, `sessions{}`).
- **–•—ç—à –ø–∞—Ä–æ–ª–µ–π**: `PBKDF2(SHA-256)` + –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å–æ–ª—å (Web Crypto API).
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è, –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤:
  - `access` (5 –º–∏–Ω—É—Ç),
  - `refresh` (24 —á–∞—Å–∞).
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ `user`/`admin` –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —Ä–µ—Å—É—Ä—Å–∞–º.
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏**: —Å–æ–∑–¥–∞–Ω–∏–µ, refresh, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π/–≤—Å–µ—Ö.

### –î–æ–ø. –∑–∞–¥–∞–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã)
- **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ä–æ–≥–æ –∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º **–≤—Å–µ—Ö** —Å–µ—Å—Å–∏–π.
- **MFA (–¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –≤—Ö–æ–¥)**: 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (TTL 5 –º–∏–Ω—É—Ç).
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏** (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ `user`/`admin`, –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É).

---

## üß≠ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`register.html`)  
   –í–≤–æ–¥ –∏–º–µ–Ω–∏/–ø–∞—Ä–æ–ª—è/—Ä–æ–ª–∏ ‚Üí –ø–∞—Ä–æ–ª—å —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è (—Å–æ–ª—å + PBKDF2) ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (`login.html`)  
   –í–≤–æ–¥ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è ‚Üí  
   ‚Ä¢ –µ—Å–ª–∏ **MFA –≤—ã–∫–ª—é—á–µ–Ω–∞** ‚Üí —Å—Ä–∞–∑—É –≤—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å;  
   ‚Ä¢ –µ—Å–ª–∏ **MFA –≤–∫–ª—é—á–µ–Ω–∞** ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `mfa.html`.

3. **MFA** (`mfa.html`)  
   –í–≤–æ–¥ 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (–≤ –¥–µ–º–æ –∫–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ) ‚Üí –≤—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å.

4. **–ü–∞–Ω–µ–ª—å** (`app.html`)  
   - **–î–æ—Å—Ç—É–ø—ã**: –∫–Ω–æ–ø–∫–∏ `USER`/`ADMIN` –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π.  
   - **Refresh**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–µ–≥–æ `access` –ø–æ `refresh`.  
   - **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è**: –≤–≤–æ–¥ —Å—Ç–∞—Ä–æ–≥–æ/–Ω–æ–≤–æ–≥–æ ‚Üí –≤—Å–µ —Å–µ—Å—Å–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è.  
   - **MFA**: –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å.  
   - **–†–æ–ª–∏**: (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) –Ω–∞–∑–Ω–∞—á–∏—Ç—å `user`/`admin` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.  
   - **–°–µ—Å—Å–∏–∏**: —Å–ø–∏—Å–æ–∫, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π/–≤—Å–µ—Ö.

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã)

- **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π**  
  `hash = PBKDF2(password, salt, SHA-256, 120 000 –∏—Ç–µ—Ä–∞—Ü–∏–π)`; –≤ –ë–î ‚Äî **—Ç–æ–ª—å–∫–æ** `salt` –∏ `hash`.

- **–¢–æ–∫–µ–Ω—ã**  
  –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ ¬´JWT-–ø–æ–¥–æ–±–Ω—ã–µ¬ª: `header.payload.signature` (base64url).  
  –í `payload`: `sub`, `role`, `sid`, `exp`. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç—Å—è (—É—á–µ–±–Ω–∞—è —Ü–µ–ª—å).

- **–°–µ—Å—Å–∏–∏**  
  –í `localStorage` + –≤ ¬´–ë–î¬ª (`sessions{}`) —Å –ø–æ–ª—è–º–∏ `accessExp`, `refreshExp`.

- **MFA**  
  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (TTL 5 –º–∏–Ω—É—Ç). –ù–µ–≤–µ—Ä–Ω—ã–π/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π –∫–æ–¥ ‚Üí –æ—Ç–∫–∞–∑.

- **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è**  
  –ù–æ–≤–∞—è —Å–æ–ª—å –∏ —Ö—ç—à, –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ **–≤—Å–µ—Ö** —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

>‚ö†Ô∏è –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ë–î, –ø–æ–¥–ø–∏—Å—å/–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT, –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞, rate-limit, HTTPS, CSRF/Replay-–∑–∞—â–∏—Ç—ã –∏ —Ç.–¥. –ó–¥–µ—Å—å ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏–∫–∏.

---

## üß™ –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Üí –∑–∞–ø–∏—Å—å –≤ –ë–î (–ø—Ä–æ–≤–µ—Ä—å –≤ DevTools ‚Üí Application ‚Üí Local Storage).  
2. **–í—Ö–æ–¥ (–±–µ–∑ MFA)** ‚Üí –¥–æ—Å—Ç—É–ø –∫ `USER` –µ—Å—Ç—å, –∫ `ADMIN` ‚Äî –Ω–µ—Ç.  
3. **–í–∫–ª—é—á–∏—Ç—å MFA** ‚Üí –≤—ã–π—Ç–∏ ‚Üí –≤–æ–π—Ç–∏ ‚Üí `mfa.html` ‚Üí –≤–≤–µ—Å—Ç–∏ –∫–æ–¥ ‚Üí –ø–∞–Ω–µ–ª—å.  
4. **–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å admin** (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∞) ‚Üí –≤—ã–π—Ç–∏/–≤–æ–π—Ç–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `ADMIN`.  
5. **Refresh**: –¥–æ–∂–¥–∞—Ç—å—Å—è –∏—Å—Ç–µ—á–µ–Ω–∏—è `access` ‚Üí –Ω–∞–∂–∞—Ç—å ¬´–û–±–Ω–æ–≤–∏—Ç—å access¬ª ‚Üí –¥–æ—Å—Ç—É–ø –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.  
6. **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è** ‚Üí –≤—Å–µ —Å–µ—Å—Å–∏–∏ —Å–ª–µ—Ç–∞—é—Ç ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º.  
7. **–°–µ—Å—Å–∏–∏**: –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö ‚Üí —Å–ø–∏—Å–æ–∫/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π/–≤—Å–µ—Ö.

---

## üß† –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API (`lab6.js`)

| –ú–µ—Ç–æ–¥                                 | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                         |
|---------------------------------------|----------------------------------------------------|
| `LAB6.register(username, password, role)` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (PBKDF2 + —Å–æ–ª—å).                    |
| `LAB6.login(username, password)`      | –í—Ö–æ–¥. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `'mfa'` –∏–ª–∏ `'ok'`.              |
| `LAB6.peekMFACode()`                  | (–î–µ–º–æ) –ø–æ–ª—É—á–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –¥–ª—è `mfa.html`.|
| `LAB6.verifyMFA(code)`                | –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥ –∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é.     |
| `LAB6.current()`                      | –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (–¥–ª—è UI).                |
| `LAB6.refresh()`                      | –û–±–Ω–æ–≤–∏—Ç—å `access` –ø–æ `refresh`.                   |
| `LAB6.call(scope)`                    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞: `scope = 'user' | 'admin'`.     |
| `LAB6.changePassword(old, neu)`       | –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è + –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π.       |
| `LAB6.setMFA(onOrObj)`                | –í–∫–ª/–≤—ã–∫–ª MFA (`true/false`; –∑–∞–¥–µ–ª –¥–ª—è Telegram/TOTP). |
| `LAB6.setRole(username, role)`        | –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω).                    |
| `LAB6.listSessions()`                 | –°–ø–∏—Å–æ–∫ –º–æ–∏—Ö —Å–µ—Å—Å–∏–π (–∫—Ä–∞—Ç–∫–æ).                      |
| `LAB6.killCurrent()` / `LAB6.killAllMine()` | –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é / –≤—Å–µ –º–æ–∏ —Å–µ—Å—Å–∏–∏.             |
| `LAB6.logout()`                       | –í—ã—Ö–æ–¥ (—Å–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ).          |

---

## üîå (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) MFA —á–µ—Ä–µ–∑ Telegram

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–¥ –≤ **Telegram** (–±–æ—Ç + –ª—ë–≥–∫–∏–π –±—ç–∫–µ–Ω–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä Cloudflare Workers).  
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç `/start <–ª–æ–≥–∏–Ω_–Ω–∞_—Å–∞–π—Ç–µ>` –≤ –±–æ—Ç–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `chat_id` ‚Üí —Å–∞–π—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ –±—ç–∫–µ–Ω–¥ ‚Üí –±—ç–∫–µ–Ω–¥ ‚Äî –≤ Telegram.  
–≠—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
